<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link href="https://fonts.googleapis.com/css?family=Maven+Pro:400,500&amp;subset=latin-ext,vietnamese" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Dancing+Script:400,700&amp;subset=vietnamese" rel="stylesheet">
  <meta name="google-site-verification" content="8zqeFQNuNAWS7ye6oN69hdEeYC_RsDyAlhht79xtAQo" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:image" content="/build-notes/assets/img/banner.png" />

  

  <title>
    
      Wintersewg20 Now Or Never | BUILD Notes
    
  </title>

  

  <!-- page's cover -->
  
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1234">
    <meta property="og:image:height" content="592">
  

  

  <link rel="shortcut icon" type="image/x-icon" href="/build-notes/assets/img/favicon.ico">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/materialize/0.99.0/css/materialize.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="/build-notes/assets/css/main.css">
  <link rel="stylesheet" href="/build-notes/assets/css/thi_scss.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@200;400;600&display=swap" rel="stylesheet"> 

  
    
      <link rel="stylesheet" href="/build-notes/assets/css/post.css">
    
  

  

  <link rel="stylesheet" href="/build-notes/assets/css/syntax.css">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/build-notes/feed.xml">
  <link rel="sitemap" type="application/xml" title="Sitemap" href="/build-notes/sitemap.xml">
  
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Wintersewg20 Now Or Never" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="What is ABI, and What Should WG21 Do About It?" />
<meta property="og:description" content="What is ABI, and What Should WG21 Do About It?" />
<link rel="canonical" href="/build-notes/papers/wintersewg20-now-or-never" />
<meta property="og:url" content="/build-notes/papers/wintersewg20-now-or-never" />
<meta property="og:site_name" content="BUILD Notes" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Wintersewg20 Now Or Never" />
<script type="application/ld+json">
{"url":"/build-notes/papers/wintersewg20-now-or-never","@type":"WebPage","description":"What is ABI, and What Should WG21 Do About It?","headline":"Wintersewg20 Now Or Never","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
	<header>
  
    <div class="container">
  <a href="#" data-activates="slide-out" class="button-collapse top-nav full hide-on-large-only">
    <i class="material-icons">menu</i>
  </a>
</div>
<div id="slide-out" class="side-nav fixed">
  <div>
    <div class="userView thi-userView">
      <div class="background"></div>
        <a href="/build-notes/">
          <img style="display:inherit;" class="circle z-depth-2" src="/build-notes/assets/img/napkins.png">
        </a>
      <span style="font-size: larger;" class="white-text name">buildsi/build-notes</span>
      <span class="white-text email"><a style="color: #bdbdbd;" href="https://github.com/buildsi/build-notes"></a></span>
    </div>
  </div>
  <div style="padding: 10px;">
    <form action="/build-notes/search" method="get">
      <input class="search-sidebar" type="search" name="q"  placeholder="search something?" autofocus>
      <input type="submit" value="Search" style="display: none;">
    </form>
  </div>
  <div id="toc-bar">
    <div class="toc-bar-title">
      In this post
    </div>
    <ol id="toc-sidebar">
  <li><a href="#what-is-abi-and-what-should-wg21-do-about-it">What is ABI, and What Should WG21 Do About It?</a>
    <ol>
      <li><a href="#tldr">TLDR</a></li>
      <li><a href="#overview">Overview</a>
        <ol>
          <li><a href="#wg21">WG21</a></li>
        </ol>
      </li>
    </ol>
  </li>
</ol>
  </div>
</div>

  
</header>
<main>
  <div class="container">
    <div id="post-info">
      <h3>Wintersewg20 Now Or Never</h3>
      <span>
        Updated on
        <span style="display: initial;" class="cat-class"></span>
         <a style="float:right" href="https://github.com/buildsi/build-notes/edit/main/_papers/wintersewg20-now-or-never.md" target="_blank">🗒️ Edit on GitHub</a>
      </span>
    </div>

    <div class="divider"></div>
    <div class="row thi-post">
      <div class="col s12">
        <h2 id="what-is-abi-and-what-should-wg21-do-about-it">What is ABI, and What Should WG21 Do About It?</h2>

<h3 id="tldr">TLDR</h3>

<p>ABI == Application Binary Interface. This (document? email?) seems to be talking
about it in context of WG21, which I can only guess means “Working Group 2021,” some
kind of group that reviews changes to C++ that might break ABI (and thus doesn’t allow).
This author, however is suggesting that:</p>

<blockquote><p>We should change themangling for C++23 symbols in a way that is not compatible with previous C++manglings.​</p><cite><a class="citation" href="#winters:ewg20-now-or-never">[1]</a></cite></blockquote>

<p>and changing the manglings so it can be detected at load time via a prefix (e.g., _Z vs _Y). He thinks it’s reasonable to break ABI every ~3 years, and force rebuilds. He thinks 
the other alternative (not breaking it) will lose industry involvement. It’s interesting that this seems to be a cultural thing - so far the standard has been to not break it,
but there are greater costs to this over time.</p>

<h3 id="overview">Overview</h3>

<p>The idea of ABI compatibility is much simpler than I anticipated. This might be an oversimplifcation, but when we compile the code in C/C++, we have “mangled strings”
that are left behind in the binary to help with linking (this could be more specific).
A nice example from Wikipedia is the following:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span><span class="err">​</span> <span class="n">wikipedia</span> <span class="p">{</span>
    <span class="err">​</span><span class="k">class</span><span class="err">​</span> <span class="n">article</span> <span class="err">​</span><span class="p">{</span>
        <span class="k">public</span><span class="err">​</span><span class="o">:</span><span class="err">​</span>
             <span class="cm">/* Mangles as: _ZN9wikipedia7article6formatEv */</span>      
             <span class="n">std</span><span class="err">​</span><span class="o">::</span><span class="err">​</span><span class="n">string</span><span class="err">​</span> <span class="n">format</span><span class="err">​</span><span class="p">(</span><span class="err">​</span><span class="kt">void</span><span class="err">​</span><span class="p">);</span>
         <span class="err">​</span><span class="p">};</span>
    <span class="p">};</span>
</code></pre></div></div>

<p>So if we change the name, arguments, or even template arguments for a function,
that is an ABI change because it changes this “mangled name.”</p>

<p>An <strong>ABI Break</strong> is thus when something changes to warrant using a different function
to generate the mangled name, or generating a different mangled name all together.
If two compiled binaries are talking to one another, they have to agree on that name.
The document mentions that it’s no different than a binary file format or network protocol
in that sender and receiver have to agree on how to interpret a file.</p>

<p><strong>Hyrum’s Law</strong> says that when you have enough users of an API, all endpoints/behaviors
are going to be depended on by somebody. This is an argument for not breaking ABI because so many depend on it. E.g., the ecosystem (gcc and clang) has used it for 10+ years and changing it would break a lot. But it’s also an argument for breaking ABI because it’s inevitable.</p>

<p>The author is worried that if we don’t break it, industry involvement will decrease,
because not breaking it means too many sacrifices to performance.</p>

<h4 id="wg21">WG21</h4>

<p>The purpose of this group is revealed on page 5:</p>

<blockquote>
  <p>…the behavior of WG21 for several years has been to give standardlibrary implementers an effective veto on any proposal that would break ABI.</p>
</blockquote>

<p>Wow, so we need humans to check and manage these changes. Isn’t that error prone? 
The author mentions taking an “ABI break” and I’m not clear what that means.
Wouldn’t so many things break?</p>

<hr />

<ol class="bibliography"><li><div>
    <div><span id="winters:ewg20-now-or-never">T. Winters, “What is ABI, and What Should WG21Do About It?,” in <i>C++ Standards Committee WG21</i>, 2020.</span>
    <a href="/build-notes/paper-details/winters_ewg20-now-or-never.html">Full details</a> |
    <a href="https://github.com/LLNL/build-bib/blob/main/papers/wintersewg20-now-or-never-a.pdf" target="_blank">PDF</a>
    </div>
</div>

<a class="details" href="/paper-details/winters_ewg20-now-or-never.html"></a></li></ol>


      <hr> 
      <ol class="bibliography"></ol>
      </div>
    </div>

    <div class="tag-list">
      
    </div>
    <form action="/build-notes/search" method="get">
	<input type="search" name="q"  placeholder="Search for..." autofocus>
	<input type="submit" value="Search" style="display: none;">
</form>

  </div>
</main>

	<script src="/build-notes/assets/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript">
  jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
      //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
      offset_opacity = 1200,
      //duration of the top scrolling animation (in ms)
      scroll_top_duration = 700,
      //grab the "back to top" link
      $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
      ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
      // if( $(this).scrollTop() > offset_opacity ) { 
      //  $back_to_top.addClass('cd-fade-out');
      // }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
      event.preventDefault();
      $('body,html').animate({
        scrollTop: 0 ,
        }, scroll_top_duration
      );
    });

  });
</script>
<style type="text/css">
.cd-top {
  display: inline-block;
  height: 50px;
  width: 50px;
  position: fixed;
  bottom: 2%;
  right: 2%;
  border-radius: 40px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
  /* image replacement properties */
  overflow: hidden;
  text-indent: 100%;
  white-space: nowrap;
  background: #bbb url(/build-notes/assets/img/cd-top-arrow.svg) no-repeat center 50%;
  visibility: hidden;
  opacity: 0;
  -webkit-transition: opacity .3s 0s, visibility 0s .3s;
  -moz-transition: opacity .3s 0s, visibility 0s .3s;
  transition: opacity .3s 0s, visibility 0s .3s;
}
.cd-top.cd-is-visible, .cd-top.cd-fade-out, .no-touch .cd-top:hover {
  -webkit-transition: opacity .3s 0s, visibility 0s 0s;
  -moz-transition: opacity .3s 0s, visibility 0s 0s;
  transition: opacity .3s 0s, visibility 0s 0s;
}
.cd-top.cd-is-visible {
  /* the button becomes visible */
  visibility: visible;
  opacity: 1;
}
.cd-top.cd-fade-out {
  /* if the user keeps scrolling down, the button is out of focus and becomes less visible */
  opacity: .5;
}
.no-touch .cd-top:hover {
  background-color: #e86256;
  opacity: 1;
}
</style>

<a href="#0" class="cd-top">Top</a>

	<footer class="page-footer teal">
  <div class="footer-copyright">
    <div class="container text-white">
          <a class="waves-effect" href="/build-notes/tags">Tags</a> | <a class="waves-effect" href="/build-notes/categories">Categories</a> | <a class="waves-effect" href="https://github.com/buildsi/build-notes">GitHub</a>
    </div>
  </div>
</footer>

<script src="//code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/materialize/0.99.0/js/materialize.min.js"></script>


  
    <script src="/build-notes/assets/js/post.js"></script>
  



<script src="/build-notes/assets/js/main.js"></script>

</body>
</html>